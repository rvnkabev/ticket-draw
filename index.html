<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>æ‹‰æ¡¿æŠ½çæ©Ÿ</title>
  <style>
    body { background: #111; color: white; font-family: sans-serif; text-align: center; padding: 30px; }
    .hidden { display: none; }
    .menu button {
      padding: 15px 30px; font-size: 1.2em; margin: 10px;
      background: #444; color: white; border: none; border-radius: 10px; cursor: pointer;
    }
    .menu button:hover { background: gold; color: black; }
    .menu p { margin-top: 10px; font-size: 1em; color: #ccc; }
    .import-box {
      position: fixed; bottom: 5px; right: 10px;
      opacity: 0.3; font-size: 12px;
    }
    .import-box input { width: 60px; font-size: 12px; }

    .reel, .single-reel {
      width: 70px; height: 70px; font-size: 2em;
      background: #222; line-height: 70px; border-radius: 10px;
      border: 2px solid #666; box-shadow: 0 0 6px #444; margin: 5px auto;
    }
    .reels { display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; }

    .lever {
      width: 20px; height: 100px;
      background: linear-gradient(to bottom, silver, gray);
      border-radius: 10px; position: relative; cursor: pointer;
      transition: transform 0.3s ease; margin: 0 auto;
    }
    .lever-ball {
      position: absolute; bottom: -25px; left: 50%;
      transform: translateX(-50%); width: 40px; height: 40px;
      background: red; border-radius: 50%; border: 3px solid #fff;
    }
    .lever.down { transform: rotate(30deg); }

    button { margin: 10px; padding: 10px 20px; font-size: 1em; }
    .redeem-btn { padding: 8px 18px; }
  </style>
</head>
<body>

  <!-- é¦–é  -->
  <div id="menu" class="menu">
    <h1>æ­¡è¿ä¾†åˆ°æ‹‰æ¡¿æŠ½çæ©Ÿ</h1>
    <p>ä½ ç›®å‰æœ‰ <strong id="homeTickets">0</strong> å¼µç¥¨åˆ¸</p>
    <button onclick="showSection('single')">ä¸€æŠ½</button>
    <button onclick="showFiveStage()">äº”é€£æŠ½</button>
    <button onclick="showSection('redeem')">Redeem</button>
  </div>

  <!-- å°å…¥ç¥¨åˆ¸æ¬„ï¼ˆä½èª¿ï¼‰ -->
  <div class="import-box">
    <label>å°å…¥ç¥¨åˆ¸ï¼š</label>
    <input id="importInput" type="number" placeholder="0" />
    <button onclick="addImportedTickets()">åŠ </button>
  </div>

  <!-- å–®æŠ½ -->
  <div id="single" class="hidden">
    <h2>å–®æŠ½è½‰ç›¤</h2>
    <div class="reel single-reel" id="singleReel">ğŸ’</div>
    <div class="lever" id="lever" onclick="pullSingle()"><div class="lever-ball"></div></div>
    <div id="singleResult"></div>
    <button onclick="showSection('menu')">è¿”å›é¦–é </button>
  </div>

  <!-- äº”é€£æŠ½ -->
  <div id="fiveStage" class="hidden">
    <h2>äº”é€£æŠ½æ¼”å‡º</h2>
    <div class="reels" style="margin-top:20px;">
      <div class="reel" id="fs0">ğŸ’</div>
      <div class="reel" id="fs1">ğŸ’</div>
      <div class="reel" id="fs2">ğŸ’</div>
      <div class="reel" id="fs3">ğŸ’</div>
      <div class="reel" id="fs4">ğŸ’</div>
    </div>
    <div id="fiveStageResult" style="margin-top:20px; font-size:1.1em;"></div>
    <button onclick="returnToMenu()">è¿”å›é¦–é </button>
  </div>

  <!-- ç¥¨åˆ¸å…Œæ› -->
  <div id="redeem" class="hidden">
    <h2>ç¥¨åˆ¸å…Œæ›</h2>
    <p>ä½ ç›®å‰æœ‰ <strong id="ticketCount">0</strong> å¼µç¥¨åˆ¸</p>
    <button class="redeem-btn" onclick="redeem(1)">Small (-1)</button>
    <button class="redeem-btn" onclick="redeem(20)">Medium (-20)</button>
    <button class="redeem-btn" onclick="redeem(100)">Big (-100)</button>
    <button class="redeem-btn" onclick="customRedeem()">Custom</button>
    <div id="redeemResult"></div>
    <button onclick="showSection('menu')">è¿”å›é¦–é </button>
  </div>

  <!-- åŠŸèƒ½è…³æœ¬ -->
  <script>
    let tickets = parseInt(localStorage.getItem("tickets") || "0");

    function getTicketByChance() {
      const r = Math.random();
      if (r < 2/7) return 0;
      if (r < 4/7) return 1;
      if (r < 6/7) return 2;
      return 3;
    }

    function updateAllDisplays() {
      document.getElementById("homeTickets").innerText = tickets;
      document.getElementById("ticketCount").innerText = tickets;
    }

    function showSection(id) {
      ["menu", "single", "fiveStage", "redeem"].forEach(sec => {
        document.getElementById(sec).classList.add("hidden");
      });
      document.getElementById(id).classList.remove("hidden");
      updateAllDisplays();
    }

    function addImportedTickets() {
      const val = parseInt(document.getElementById("importInput").value);
      if (!isNaN(val) && val > 0) {
        tickets += val;
        localStorage.setItem("tickets", tickets);
        updateAllDisplays();
        document.getElementById("importInput").value = "";
      }
    }

    function pullSingle() {
      const reel = document.getElementById("singleReel");
      const lever = document.getElementById("lever");
      const result = document.getElementById("singleResult");
      result.innerHTML = "";
      lever.classList.add("down");
      setTimeout(() => lever.classList.remove("down"), 300);
      let count = 0;
      const interval = setInterval(() => {
        reel.innerText = ["7","ğŸ’","ğŸ‹","ğŸ””","ğŸ’","â­"][Math.floor(Math.random()*6)];
        count++;
        if (count >= 20) {
          clearInterval(interval);
          const gain = getTicketByChance();
          tickets += gain;
          localStorage.setItem("tickets", tickets);
          result.innerHTML = `ä½ ç²å¾—äº† <strong>${gain}</strong> å¼µç¥¨åˆ¸ï¼`;
          updateAllDisplays();
        }
      }, 100);
    }

    function showFiveStage() {
      showSection("fiveStage");
      const symbols = ["7","ğŸ’","ğŸ‹","ğŸ””","ğŸ’","â­"];
      const reels = [0,1,2,3,4].map(i => document.getElementById("fs" + i));
      const resultBox = document.getElementById("fiveStageResult");
      resultBox.innerHTML = "é–‹å§‹æŠ½ç...";
      let total = 0, current = 0;

      function spinOne(index) {
        if (index >= 5) {
          localStorage.setItem("tickets", tickets);
          resultBox.innerHTML += `<br><strong>ç¸½å…±ç²å¾— ${total} å¼µç¥¨åˆ¸ï¼</strong>`;
          updateAllDisplays();
          return;
        }
        let count = 0;
        const spin = setInterval(() => {
          reels[index].innerText = symbols[Math.floor(Math.random() * symbols.length)];
          count++;
          if (count >= 20) {
            clearInterval(spin);
            const final = symbols[Math.floor(Math.random() * symbols.length)];
            reels[index].innerText = final;
            const gain = getTicketByChance();
            tickets += gain;
            total += gain;
            resultBox.innerHTML += `<br>ç¬¬ ${index + 1} æŠ½ï¼š${final} â†’ +${gain}ç¥¨`;
            setTimeout(() => spinOne(index + 1), 500);
          }
        }, 50);
      }

      spinOne(0);
    }

    function returnToMenu() {
      showSection("menu");
    }

    function redeem(amount) {
      const msg = document.getElementById("redeemResult");
      if (tickets >= amount) {
        tickets -= amount;
        localStorage.setItem("tickets", tickets);
        msg.innerHTML = `æˆåŠŸå…Œæ› ${amount} å¼µç¥¨åˆ¸ï¼`;
      } else {
        msg.innerHTML = `ç¥¨åˆ¸ä¸è¶³ï¼Œç„¡æ³•å…Œæ› ${amount} å¼µã€‚`;
      }
      updateAllDisplays();
    }

    function customRedeem() {
      let v = parseInt(prompt("è«‹è¼¸å…¥è¦å…Œæ›çš„ç¥¨åˆ¸æ•¸ï¼š"));
      if (!isNaN(v) && v > 0) redeem(v);
    }

    updateAllDisplays();
  </script>

</body>
</html>